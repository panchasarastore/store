---
const {
  store = {},
  theme = {},
  products = [],
  isPreview = false,
} = Astro.props;

// 1. Safe Defaults
const safeStore = {
  name: store.name ?? 'Your Store Name',
  tagline: store.tagline ?? 'A short soulful tagline',
  about: store.about ?? 'Tell customers about your craft, your journey, and what makes you special.',
  logo: store.logo ?? null,
};

// 2. Handle Colors (Support both flat and nested structures)
const colors = theme.colors ?? {
  primary: theme.primary ?? '#c46a2b',
  secondary: theme.secondary ?? '#7a5c3d',
  background: theme.background ?? '#fffaf0',
  text: theme.text ?? '#5b3a1e',
};

// 3. Generate CSS Variables String
// We inject this into the wrapper so the JS can update them easily
const themeStyles = `
  --theme-primary: ${colors.primary};
  --theme-secondary: ${colors.secondary};
  --theme-background: ${colors.background};
  --theme-text: ${colors.text};
`;

// 4. Placeholder Products (if empty)
const displayProducts = products.length > 0 ? products : [
  { name: 'Rustic Sourdough', price: 12.00, image: 'https://images.unsplash.com/photo-1585476644321-b97621402e89?auto=format&fit=crop&w=600&q=80' },
  { name: 'Olive & Rosemary', price: 14.00, image: 'https://images.unsplash.com/photo-1509440159596-0249088772ff?auto=format&fit=crop&w=600&q=80' },
  { name: 'Cranberry Walnut', price: 15.00, image: 'https://images.unsplash.com/photo-1550989460-0adf9ea622e2?auto=format&fit=crop&w=600&q=80' }
];
---

<div
  class="store-template-wrapper"
  data-preview={isPreview}
  style={themeStyles}
  data-font-preset="classic" 
  data-layout="classic"
>
  <header class="store-header">
    <div class="store-header-content">
      <div class="store-logo-area">
        {safeStore.logo ? (
          <img src={safeStore.logo} class="store-template-logo" alt={safeStore.name} />
        ) : (
          /* We keep the img hidden so JS can reveal it if user uploads a logo */
          <>
            <img class="store-template-logo" style="display:none" alt="Logo" />
            <span class="store-logo-initial">{safeStore.name.charAt(0) || 'S'}</span>
          </>
        )}
      </div>

      <h1 class="store-name store-template-name">{safeStore.name}</h1>

      <nav class="store-nav">
        <span>Shop</span>
        <span>About</span>
        <span>Cart (0)</span>
      </nav>
    </div>
  </header>

  <section class="store-hero">
    <h2 class="store-tagline store-template-tagline">{safeStore.tagline}</h2>

    <div class="store-about-preview">
      <p class="store-template-about">
        {safeStore.about}
      </p>

      <button class="hero-cta">
        Explore Collection
      </button>
    </div>
  </section>

  <section class="store-products">
    <div class="products-header">
      <h3>Signature Collection</h3>
      <span class="view-all">View All</span>
    </div>

    <div class="products-grid">
      {displayProducts.map((product) => (
        <div class="product-card">
          <div class="product-image">
            <img src={product.image} alt={product.name} />
          </div>

          <h4 class="product-name">{product.name}</h4>

          <div class="product-footer">
            <span class="product-price">${Number(product.price).toFixed(2)}</span>
            <button class="product-add" disabled>
              <span class="add-icon">+</span>
            </button>
          </div>
        </div>
      ))}
    </div>
  </section>

  <footer class="store-footer">
    <div class="footer-content">
      <div class="footer-logo">{safeStore.name.charAt(0) || 'S'}</div>
      
      <p class="footer-about store-template-about">
        {safeStore.about.substring(0, 120)}...
      </p>

      <p class="footer-credit">
        Â© {new Date().getFullYear()} <span class="store-template-name">{safeStore.name}</span>
      </p>
    </div>
  </footer>
</div>