<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Test Checkout (Payment Link)</title>
        <style>
            body {
                font-family: system-ui, sans-serif;
                background: #f6f7fb;
                padding: 40px;
            }

            .card {
                max-width: 420px;
                margin: auto;
                background: #fff;
                padding: 24px;
                border-radius: 10px;
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
            }

            h2 {
                margin-bottom: 16px;
            }

            label {
                display: block;
                font-size: 14px;
                margin-top: 12px;
            }

            input {
                width: 100%;
                padding: 10px;
                margin-top: 6px;
                border-radius: 6px;
                border: 1px solid #ccc;
            }

            button {
                margin-top: 20px;
                width: 100%;
                padding: 12px;
                font-size: 16px;
                background: #4f46e5;
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
            }

            button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .error {
                color: #dc2626;
                margin-top: 12px;
                font-size: 14px;
            }
        </style>
    </head>

    <body>
        <div class="card">
            <h2>Place Order</h2>

            <label>Name</label>
            <input id="name" value="Test User" />

            <label>Phone</label>
            <input id="phone" value="7012079459" />

            <label>Email</label>
            <input id="email" value="abrahammadamana@gmail.com" />

            <button id="payBtn">Pay Now</button>
            <div id="error" class="error"></div>
        </div>

        <script>
            const btn = document.getElementById("payBtn");
            const errorDiv = document.getElementById("error");

            btn.addEventListener("click", async () => {
                btn.disabled = true;
                errorDiv.textContent = "";

                try {
                    const payload = {
                        store_id: "893c317f-3464-4778-9603-447ae3ba322e",
                        customer: {
                            name: document.getElementById("name").value,
                            phone: document.getElementById("phone").value,
                            email: document.getElementById("email").value,
                        },
                        delivery: {
                            method: "pickup",
                            address: null,
                            lat: null,
                            lng: null,
                            date: null,
                        },
                        items: [
                            {
                                product_id:
                                    "3d36ce94-b774-4549-bb39-880b2516f085",
                                quantity: 1,
                                variant: null,
                                custom_note: "Test order via payment link",
                            },
                        ],
                    };

                    const res = await fetch(
                        "https://flltodzoonathwovcicj.supabase.co/functions/v1/Place-Order",
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload),
                        },
                    );

                    const data = await res.json();

                    if (!res.ok) {
                        throw new Error(data || "Order creation failed");
                    }

                    // Redirect to Cashfree payment link
                    window.location.href = data.payment_link_url;
                } catch (err) {
                    errorDiv.textContent =
                        err.message || "Something went wrong";
                    btn.disabled = false;
                }
            });
        </script>
    </body>
</html>
